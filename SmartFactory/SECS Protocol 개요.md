# SECS (SEMI Equipments Communication Standard, 반도체 설비 통신 표준) Protocol 관련 자료

  반도체장비기술교육센터(SETEC) 기술교육 시리즈(1-1)

반도체 장비 간 통신 표준(SECS)  
자료제공: 아이티이노베이션  
           김원태 대표이사  

Ⅰ. 시작하기  

  반도체나 FPD 생산 공정은 그 작업의 특성상 무인 자동화 생산을 많이 요구한다. 작은 particle 관리가 중요한 만큼 사람에 의해 발생하는 particle을 줄이기 위해서, 또 생산에 소요되는 인건비를 줄이기 위해서 자동화를 추진한다. 그리고, 개인적인 생각이지만, 무엇보다 크린룸 환경이 사람에게 그리 편하지 않은 환경이기 때문이기도 하다.
  반도체나 FPD 생산 공정의 자동화는 데이터베이스와 스케줄링으로 대변된다. 생산 자재에 대한 데이터베이스를 구축하고 각 공정에 맞게 생산을 스케줄링하는 것이 핵심이다. 이 바탕 위에 생산성 향상을 위해 FDC 등의 각종 관리 기술이 추가된다.
  이런 자동화는 각 생산 장비와 MES 사이의 원활한 데이터 통신을 기반으로 한다. 그러나 장비 업체마다 사용하는 통신 프로토콜이 다르고 장비의 동작 방식이 다르다면, 이를 통합해서 관리하는 것 자체가 불가능할 수도 있다. 이런 이유로 세계반도체협회(SEMI, Semiconductor Equipment and Materials International)에서는 반도체 장비 간 통신 프로토콜에 대한 표준 및 장비의 동작과 통신 시나리오에 대한 표준을 다음과 같이 정하고 있다.


Ⅱ. SECS 프로토콜

  일반적으로 SECS-I, SECS-II와 HSMS를 묶어서 SECS 프로토콜이라 부른다. SECS는 SEMI Equipment Communications Standard의 약어로, 반도체 장비 간 통신의 표준이다.
  여기서 SECS-II는 실제 통신되는 데이터에 대한 규약이고, SECS-I과 HSMS는 SECS-II 데이터를 RS-232C와 Ethernet을 통해 전송하기 위한 규약이다.


Ⅲ. SECS-I

  SECS-I은 SECS-II 데이터를 RS-232C 통신을 통해 전송하기 위한 규약으로, SEMI E4 SEMI Equipment Communications Standard 1 Message Transfer에 정의되어 있다.
  1980년 SECS-I에 대한 규정이 처음 제작되었는데, 1990년대 중반까지도 많은 장비가 이 규약에 의해 통신을 수행했다. 하지만 Ethernet이 보편화되면서 통신 속도와 용량 등의 문제로 HSMS에 밀려 지금은 그 사용이 많이 줄었다.

1. 블록(Block) 구성
  SECS-I 메시지는 블록 단위로 전송된다. 하나의 블록은 헤더와 SECS-II 데이터로 구성되는데, 그 크기는 Length Byte와 Checksum을 제외하고 10&#126;254 바이트의 범위이다.
  SECS-I 메시지 블록의 구조는 다음과 같다.
  A 영역은 Length Byte로 SECS-I 메시지의 길이를 의미하는데, B+C 영역의 크기를 가리킨다.
  B 영역은 SECS-I 헤더에 해당한다.
  C 영역은 실제 전송하고자 하는 데이터로, 그 형식은 SECS-II 데이터 형식을 따른다.
  D 영역은 블록 데이터 확인을 위한 Checksum으로, B+C 영역의 각 바이트를 산술적으로 모두 더한 값이다.

2. 헤더(Header) 구성
  첫 두 바이트(1, 2)는 Device ID를 나타낸다. Device ID란 호스트가 장비를 구별하기 위해서 장비에 부여하는 고유한 논리 ID로, 호스트는 Device ID를 갖지 않기 때문에 이 값에는 언제나 장비의 Device ID가 설정된다. 이 영역 첫 바이트의 최상위 비트(Bit)는 Reverse Bit(R-bit)라고 불리는데, 호스트가 장비로 보내는 메시지는 이 비트를 0으로 설정하고, 장비가 호스트로 보내는 메시지는 1로 설정한다.
  다음 두 바이트(3, 4)는 개별 SECS-II 메시지의 ID를 의미한다. 첫 바이트는 SECS-II의 스트림(Stream, S)을, 다음 바이트는 펑션(Function, F)을 나타낸다. 스트림 바이트의 최상위 비트는 Wait Bit(W-bit)라고 불리는데, Primary 메시지에 대한 Secondary 메시지의 필요 여부를 나타낸다. 이 비트가0이면 응답이 필요 없는 메시지이고, 1이면 응답을 요구하는 메시지가 된다.
  다음의 두 바이트(5, 6)는 블록의 일련번호를 의미한다. SECS-I 블록의 크기 제한(254 바이트) 때문에 긴 메시지는 여러 블록으로 나뉘어져 사용된다. 이런 경우 각 블록은 1부터 시작하는 일련번호를 가지게 된다. C 영역 첫 바이트의 최상위 비트는 End Bit(E-bit)라고 불리는데, 메시지의 마지막 블록인지 아닌지를 표시한다. 마지막 블록의 경우에 이 비트를 1로 설정한다. 만약 다중블록(Multi-block) 메시지가 아니라 단일블록(Single-block) 메시지인 경우는 블록 일련번호를 0이나 1로 설정해야 한다. 따라서 블록 일련번호는 0&#126;32767의 값을 가질 수 있다.
  마지막 네 바이트(7&#126;10)는 시스템 바이트(System Bytes)를 의미한다. 시스템 바이트는 하나의 진행 중인 메시지 트랜잭션(Open Message Transaction)을 규정하는 ID인데, 서로 다른 진행 중인 메시지는 서로 다른 시스템 바이트를 가져야 한다. 또한 한 트랜잭션의 Primary 메시지와 Secondary 메시지는 동일한 시스템 바이트를 사용해야 하고, 다중블록 메시지의 경우도 모든 블록이 동일한 시스템 바이트를 가져야 한다.

3. 메시지 트랜잭션
  SECS-I 메시지는 블록 단위로 전송된다. 먼저 블록을 보내기 전에 Primary 메시지를 전송하려는 측에서 블록 전송에 대한 요청으로 ENQ(0x05) 신호를 전송한다. 수신하려는 측은 ENQ 신호를 받으면 이에 대한OK 응답으로 EOT(0x04)를 보낸다. EOT를 수신하면 송신측은 실제 데이터를 전송한다. 수신측은 데이터 수신하고 Checksum을 확인한 후 수신 성공에 대한 의미로 ACK(0x06)를 보낸다. 위의 과정으로 하나의 메시지 블록을 성공적으로 전송하게 된다. 만약 수신된 데이터의 Checksum에 오류가 있으면 ACK 대신 NAK(0x15)를 보낸다. 만약 메시지가 길어서 다중블록으로 전송하고자 한다면, 위의 과정을 블록 수만큼 반복한다.
  이제 Primary 메시지에 대한 전송이 끝났다. 하나의 메시지 트랜잭션을 완성하려면, 일반적으로 Primary 메시지를 수신한 측에서 이에 대한 응답으로 Secondary 메시지를 보내게 된다. Secondary 메시지를 전송하는 방법도 위와 동일한 절차를 거치면 된다.
  이 과정에서 때로는 Contention 문제가 발생하게 된다. Contention은 호스트와 장비가 동시에 ENQ를 보냄으로써 서로 메시지를 보내려고 하는 경우를 말하는데, 이 경우는 마스터로 설정된 측이 우선권을 가지게 된다. 즉, 동시에 양측이 ENQ를 보내게 되는 경우 - ENQ를 보냈는데 EOT를 받지 못하고 상대방의 ENQ를 받는 경우 - 슬레이브로 설정된 측이 보냈던 ENQ를 포기하고 마스터의 요구에 따라 EOT를 보내고 데이터를 수신하게 된다.

4. 타임아웃(Timeouts) 설정
  SECS-I 통신에는 여러 개의 타임아웃 값이 있다. 각 타임아웃의 정의는 다음과 같다.
  이 외에 타임아웃은 아니지만, 타임아웃과 함께 사용되는 값으로 Retry Limit이 있다. 이 값은 어떤 통신스트림을 보낸 후 응답이 없을 경우에 반복해서 해당 스트림 전송을 재시도하는 횟수를 의미한다. 역시 이 횟수를 넘어섰을 경우에는 해당 메시지 트랜잭션이 취소된다.

5. 프로토콜 파라미터
  SECS-I에서 사용되는 프로토콜 파라미터는 다음과 같다.


Ⅳ. SECS-II

  SECS-II는 실제 통신을 통해 전달되는 데이터에 관한 규약으로, SEMI E5 SEMI Equipment Communications Standard 2 Message Content에 정의되어 있다.

1. 스트림/펑션(Stream/Function)
  SECS-II 메시지는 스트림과 펑션에 의해 구분된다. 스트림은 유사한 특성을 갖는 메시지의 그룹이고, 펑션은 각 스트림 내에서 특정한 기능을 하는 메시지를 가리킨다. 스트림과 펑션을 조합해서 흔히 S1F1, S6F11 등과 같이 SECS-II 메시지를 표현한다.
  SEMI에서는 특정한 기능을 갖는 SECS-II 메시지를 이미 많이 만들어 두고 사용하고 있다. 또한 사용자가 자신에게 맞는 메시지를 따로 정의해서 사용할 수 있도록 방법을 제시하고 있다.
  위의 그림에서 보는 바와 같이 S0Fy, SxF0와 S1F1&#126;S63F63까지는 SEMI 표준을 위해서 예약된 공간이다. 그리고 이 외의 부분은 사용자가 필요에 의해서 만들어 쓸 수 있는 공간이다. SEMI E5 SECS-II 표준에는 현재 SEMI에서 표준으로 만들어 놓은 SECS-II 메시지와 그 형식이 정의되어 있다.
  하지만, 사실 표준을 위해 예약된 메시지도 사업장에 따라, 또 필요에 따라 적당히 변형되어 사용되고 있는 것이 현실이다.
  다음은 현재 정의되어 있는 스트림의 종류이다.
  각 스트림과 그 안의 펑션에 대한 자세한 내용은 SEMI E5 SECS-II 문서를 참고하도록 한다.

2. 데이터 형식
  SECS-II에서 사용하는 데이터의 형식은 위와 같다. 여기서 LIST는 자신이 어떤 데이터를 가지고 있지 않고 하부에 다른 데이터 형식을 취할 수 있는 형태의 데이터이고, 다른 형식은 모두 그 값이 표현하고 있는 데이터의 형식을 가리킨다.

3. 데이터 구조
  SECS-II 데이터는 위의 예와 같은 형태로 저장된다. 각 아이템은 아이템 헤더와 아이템 바디를 가지는데, LIST 형식은 바디가 없이 리스트 헤더만 갖는다. 각 아이템은 아이템 트리에 나타난 모양과 같이 순차적으로 기록된다.
  각 LIST 헤더와 아이템 헤더의 구성은 다음과 같다.
  헤더의 첫 바이트 3&#126;8 비트에 어떤 형식의 데이터 아이템인지 그 형식이 실린다. 그리고 1&#126;2 비트에는 이 아이템의 크기가 얼마나 되는지를 표시하는 ‘Length Byte’가 몇 바이트가 따라오는지를 알려주는 정보가 실린다(‘# of Length Byte’). ‘# of Length Byte’는 두 개의 비트로 표시되기 때문에 0&#126;3의 값을 가질 수 있다. 그 뒤에‘Length Byte’가 ‘# of Length Byte’에 표시된 양만큼 따라온다. ‘Length Byte’는 뒤에 따라올 아이템 바디의 크기를 바이트로 표시하는데, 최대 3 바이트로 표시가 가능하기 때문에 아이템 바디의 크기는 0&#126;224-1의 범위가 된다.
  LIST 아이템의 경우는 ‘Length Byte’가 조금 다르게 해석된다. LIST 아이템의 경우는 아이템 바디가 없기 때문에, ‘Length Byte’의 의미가 뒤에 따라오는 아이템 바디의 크기가 아니라 LIST에 따르는 아이템의 개수를 나타내게 된다.
  이제 아이템 헤더의 분석이 끝났으니 ‘Length Byte’에 기록된 양만큼 아이템 바디가 따라오게 된다. 아이템 바디에는 하나의 데이터만 실리는 것이 아니라 배열로 여러 개의 아이템 데이터가 실릴 수 있다. 만약 아이템이 I2 형식이고 ‘Length Byte’의 값이 8이면, 4개의 I2 아이템이 배열로 기록된 것을 의미한다.

4. Data Item Dictionary
  사실 SECS와 관련된 문서는 처음 보는 사람들에게는 암호문이나 다름없다. 필자도 처음 SECS 문서를 접했을 때, 너무나 황당해서 어디부터 시작해야 할지 정말 막막했었다. 이렇게 사람을 당황하게 만드는 원인은 주로 Data Item Dictionary와 관련이 있다.
  위의 S2F23 메시지를 예로 들면, 도무지 TRID, DSPER 등이 무엇을 의미하는지 알 수가 없기 때문에 이 메시지를 해석하기가 정말로 쉽지 않다. 이 경우, TRID, DSPER, TOTSMP 등이 의미하는 것은 SEMI E5 SECS-II의 Data Item Dictionary를 찾아봐야 한다.
  SECS-II Data Item Dictionary를 보면 위와 같은 항목들을 찾아볼 수 있다. 즉, TRID란 ‘Trace Request ID’를 의미하고, 그 형식으로는 ASCII 혹은 signed/unsigned integer를 사용하며, S2F23, S6F1 등의 메시지에서 사용된다. 또, TOTSMP란 ‘Total samples to be made’를 의미하고 그 형식으로는 ASCII 혹은 signed/unsigned integer를 사용하며, S2F23, S17F5의 메시지에서 사용된다.
  이렇게 각 SECS-II 메시지를 구성하고 있는 아이템은 별도의 Data Item Dictionary를 참조하도록 되어 있다. 따라서 반도체 장비 통신을 위한 SECS 메시지를 구성하기 위해서는 E5 SECS-II 표준 문서가 필수적이다. 하지만 반도체가 아니라 FPD 자동화의 경우는 FPD 제조업체에서 자체적으로 SECS 통신에 관한 사양을 만들어서 배포하기도 하는데, 이 경우 대부분 Data Item에 대한 설명을 포함하고 있다.

5. Variable Item Dictionary
  SECS-II 데이터 아이템에는 세 종류의 변수가 있는데, 각각의 특징은 다음과 같다.
  E5 SECS-II에서는 이렇게 장비의 상태를 나타내는 표준 변수들을 미리 정의해서 기술해 놓았는데, 이를 Variable Item Dictionary라고 한다.
  정의되어 있는 Variable Item에 대한 자세한 내용은 E5 SECS-II 표준 문서를 참고한다.

6. Special Transactions
  일반적인 메시지 교환 이외에 특이하게 사용되는 다음과 같은 메시지 트랜잭션이 있다.

  1) 다중블록 메시지
  SECS-I에서 사용되는 다중블록 메시지의 경우, 전송하려는 원래 메시지를 보내기 전에 다중블록에 대한 허가 메시지를 먼저 교환한다. 만약 다중블록 메시지 전송 요청에 대해 거부 응답이 온다면 해당 메시지를 전송할 수 없다.
  이렇게 다중블록 허가를 위해 사용되는 메시지에는S2F39/F40, S3F15/16, S6F5/F6 등이 있다.

  2) Abort Transaction
  어떤 Primary 메시지에 대한 응답으로 펑션이 0인 메시지를 보내는 경우가 있는데, 이런 경우를 ‘Abort Transaction’이라고 한다. ‘Abort Transaction’이 발생하면 해당하는 스트림의 모든 트랜잭션을 모두 닫게 된다.

  3) 에러 메시지
  장비의 동작 오류가 아니라 SECS 통신의 오류로 메시지 해석에 문제가 될 때 에러 메시지를 보내게 된다.
  에러 메시지는 스트림 9에 정의되어 있는데, 각각의 내용은 다음과 같다.


Ⅴ. HSMS

  HSMS는 SECS-II 데이터를 Ethernet을 통해 전송하기 위한 규약으로, SEMI E37 High-speed SECS Message Services Generic Services에 정의되어 있다. HSMS는 E37.1 HSMS-SS(Single Session)와 E37.2 HSMS-GS(General Session)의 두 종류로 서비스 되는데, 아주 특별히 HSMS-GS를 필요로 하는 경우를 제외하고는 HSMS-SS를 사용한다. 여기서도 HSMS-SS를 기준으로 설명한다. 그리고, HSMS에서는 새로운 용어가 많이 등장하는데, 일단 용어를 먼저 사용하고 진행하면서 용어에 대한 설명을 하기로 한다.

1. Connection State Diagram
  HSMS-SS의 통신 연결 상태는 다음의 상태도로 표현된다.
  각각의 State에 대한 설명은 다음과 같다.
  여기서 각 State 사이의 전이가 이루어지는 방법은 두 경우로 나뉘어지는데, 먼저 HSMS-SS Passive Mode인 경우는 다음과 같다.
  HSMS-SS Active Mode인 경우의 State 전이는 다음과 같다.

2. 메시지 구성
  A 영역은 Length Byte로 HSMS 메시지의 길이를 의미하는데, 위의 그림에서 B+C 영역의 크기를 가리킨다. SECS-I과는 달리 4 바이트를 차지한다.
  B 영역은 HSMS 헤더 영역이다.
  C 영역은 실제 전송하고자 하는 데이터로, 그 형식은 SECS-II 데이터 형식을 따른다.
  HSMS 메시지는 SECS-I 메시지와는 달리 통신 패킷에 대한 확인을 TCP가 처리하기 때문에 Checksum이 없다.
  Length Byte가 4 바이트로 구성되는 것에서 보듯이 HSMS에서는 전송하는 데이터의 길이에 거의 제한이 없다.

3. 헤더 구성
  HSMS에서는 일반 SECS-II 데이터 메시지 외에 HSMS 연결 상태를 관리하기 위해서 컨트롤 메시지(Control Message)가 사용되는데, 일반 데이터 메시지와 컨트롤 메시지는 헤더의 형식이 조금 다르다.
  HSMS에서는 호스트와 장비라는 통신 양단의 규정이 없어지고, 동등한 수준의 Entity라는 개념이 도입되었다. Session ID는 이런 Entity 사이의 관계를 규정하는 ID인데, HSMS-SS에서는 SECS-I에서의 개념처럼 Device ID가 설정된다. 컨트롤 메시지의 경우는 Session ID에 0xFFFF를 설정한다.
  Header Byte 2는 컨트롤 메시지의 경우 0 혹은 Status Code가 지정되고 데이터 메시지의 경우는 SECS-I에서와 마찬가지로 W-bit와 SECS 스트림이 지정된다.
  Header Byte 3는 컨트롤 메시지의 경우 0 혹은 Status Code가 지정되고 데이터 메시지의 경우는 SECS-I에서와 마찬가지로 SECS 펑션이 지정된다.
  PType은 Presentation Type이라고 하는데, 어떤 형태의 데이터를 실었는지를 나타낸다. SECS-II 데이터를 사용할 때에는 0으로 설정한다.
  SType은 Session Type이라고 하는데, 데이터 메시지와 컨트롤 메시지의 종류를 구분하는데 사용된다. 데이터 메시지의 경우는 0을 설정하고, 컨트롤 메시지인 경우는 다음과 같이 메시지 종류에 맞는 값을 설정한다.
System Bytes는 SECS-I에서와 동일하게 진행 중인 트랜잭션의 고유값으로 사용된다.

4. 프로토콜 파라미터
  HSMS에서 사용되는 프로토콜 파라미터는 다음과 같다.

5. 컨트롤 메시지
  일반 데이터 메시지는 SECS-I에서와 마찬가지 방식으로 사용된다. 하지만 HSMS에서는 일반 데이터 메시지 이외에 HSMS 연결을 관리하는 컨트롤 메시지가 있다. HSMS-SS에서 사용되는 컨트롤 메시지에 대해 소개한다.

  1) Select.req/Select.rsp
  Not Selected 상태에서 Selected 상태로 전이하는 데 사용되는 메시지로, Active Entity가 Select.req를 전송한다.

  2) Deselect.req/Deselect.rsp
  양방 합의에 의해서 통신을 종료할 때 사용한다. 통신을 종료하고자 하는 측에서 Deselect.req를 보내고, 이에 대해 상대방이 응답함으로써 통신을 종료하게 된다. HSMS-SS에서는 사용하지 않고 Separate.req로 대치한다.

  3) Linktest.req/Linktest.rsp
  접속 상태의 확인 및 유지를 위해 서로의 통신이 종료된 이후 일정 주기로 Linktest.req를 보낸다. 이에 대해 응답이 없으면 Not Connected 상태로 전이한다.

  4) Separate.req
  일방적으로 통신 종료를 통보할 때 사용된다. 응답이 필요 없는 메시지로, 일반적으로 이 메시지를 보낸 직후 통신을 끊게 된다.

  5) Reject.req
  잘못된 메시지가 왔을 때 전송한다.


Ⅵ. 마치면서

  여기서 소개하지 못한 통신 내용으로 GEM, SEM 및 300mm 웨이퍼 생산에 관련된 주제가 있다. 특히 GEM은 반도체 생산 장비 간 통신의 기본 시나리오를 정의한 것으로, 반도체 장비를 생산하는 업체에서는 반드시 알아두어야 할 내용이다.
  우리나라 반도체 장비 업체의 경우 아직 GEM에 대해 잘 모르는 경우가 많다. 특히 장비의 사양서에 H/W 사양뿐 아니라 GEM 통신 사양까지 갖추어야 한다는 사실을 잘 모르고 있는 경우가 많다.
  S/W 인력을 충분히 확보하기 힘든 장비 업체의 현실에 SECS에 대한 소개가 조금이나마 도움이 되었으면 하는 바람이 있다. 그리고 어려운 환경에서도 열심히 노력하는 우리 장비 업체 여러분께 감사를 드린다.


문의: 반도체장비기술교육센터(SETEC)
Tel: 041-560-1456&#126;7
http://setec.kut.ac.kr
E-mail: setec@kut.ac.kr

문의: 아이티이노베이션 김원태 대표이사
Tel: 031-704-2058




자료 출처: https://blog.naver.com/isonex/120020791873
